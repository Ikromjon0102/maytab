{% extends 'base.html' %} {% block title %}RayONO Dashboard{% endblock %} 
{% block content %}
<div class="row mb-4">
  <div class="col-md-4">
    <div class="card bg-primary text-white p-3">
      <h3>{{ total_schools }}</h3>
      <p>Jami Maktablar</p>
      <i
        class="fa-solid fa-school position-absolute end-0 top-0 m-3 opacity-50 fa-3x"
      ></i>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card bg-success text-white p-3">
      <h3>{{ total_students }}</h3>
      <p>Jami O'quvchilar</p>
      <i
        class="fa-solid fa-users position-absolute end-0 top-0 m-3 opacity-50 fa-3x"
      ></i>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card bg-warning text-white p-3">
      <h3>{{ present_today }}</h3>
      <p>Bugungi kelganlar (Tuman bo'yicha)</p>
      <i
        class="fa-solid fa-check-circle position-absolute end-0 top-0 m-3 opacity-50 fa-3x"
      ></i>
    </div>
  </div>
</div>
<div class="row mb-4">
    <div class="col-12">
        <div class="card p-4 shadow-sm">
            <h5 class="fw-bold mb-3">üìà Tuman bo'yicha umumiy davomat dinamikasi</h5>
            <div style="height: 350px; width: 100%;">
                <canvas id="rayonoChart"></canvas>
            </div>
        </div>
    </div>
</div>
<div class="card p-3">
  <h5>üè´ Maktablar Onlayn Holati</h5>
  <table class="table table-hover mt-3">
    <thead>
      <tr>
        <th>Maktab</th>
        <th>Status</th>
        <th>O'quvchi soni</th>
        <th>Boshqaruv</th>
      </tr>
    </thead>
<tbody>
                {% for s in schools %}
                <tr>
                    <td class="fw-bold">{{ s.name }}</td>

                    <td>
                        {% if s.is_online %}
                            <span class="badge bg-success">
                                <i class="fa-solid fa-wifi me-1"></i> Online
                            </span>
                        {% else %}
                            <span class="badge bg-danger">
                                <i class="fa-solid fa-power-off me-1"></i> Offline
                            </span>
                            <br>
                            <small class="text-muted" style="font-size: 10px;">
                                {% if s.last_activity %}
                                    {{ s.last_activity|timesince }} oldin
                                {% else %}
                                    Hech qachon
                                {% endif %}
                            </small>
                        {% endif %}
                    </td>

                    <td>{{ s.students.count }}</td>
                    <td>
                         </td>
                    <td>
                        <a href="#" class="btn btn-sm btn-outline-primary">Kirish</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
  </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const ctx = document.getElementById('rayonoChart').getContext('2d');

        const labels = {{ chart_labels|safe }};
        const dataPoints = {{ chart_data|safe }};

        new Chart(ctx, {
            type: 'line', // RayONO uchun "Line" (Chiziqli) grafik chiroyli ko'rinadi
            data: {
                labels: labels,
                datasets: [{
                    label: 'Jami kelgan o\'quvchilar (Tuman bo\'yicha)',
                    data: dataPoints,
                    borderColor: '#2ecc71', // Yashil rang
                    backgroundColor: 'rgba(46, 204, 113, 0.2)',
                    borderWidth: 3,
                    fill: true, // Tagini bo'yash
                    tension: 0.3 // Egri chiziq silliqligi
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    });
</script>
{% endblock %}

